# 网络通信过程
## 相同网段的两台机器通信过程
A机器：192.168.26.129/24  
B机器：192.168.26.3/24  

这时如果A去ping B，过程如下：
1. A发现与B在同一个网段下，于是A会发起一个ARP广播，询问同一个网络地址下的所有主机，192.168.26.3这个ip是谁的，它的mac地址是什么。
2. B收到ARP广播时，发现自己的ip就是192.168.26.3，将A的mac地址写入自己的ARP缓存，并且向A发送一个ARP应答单播。
3. A收到了B的mac地址，于是分装成完整的数据帧发送到B，包中包含自己ip和目的地ip，自己的mac地址和目的地mac地址。同时A会将B的mac地址记录在自己的缓存中以备下次使用。
4. B收到了A的ping包，已经具有了双方的ip和mac地址，可以直接进行通信。

## 不同网段的两台机器通信过程
A机器：192.168.26.129/24  
B机器：192.168.25.3/24 
默认网关：192.168.26.2 

这时如果A去ping B，过程如下：
1. A发现与B在不同一个网段下，无法直接通信，只能通过路由器转发。A会发出一个ARP广播，查询默认网关192.168.26.2的mac地址。
2. 默认网关回复自己mac地址给A，A使用默认网关的ip和mac地址发送ping包，于是便间接转化成路由器和B之间的通信
3. 默认网关如果没有B的mac地址，也会发起一个ARP广播查询B的mac地址，B回复Mac地址给默认网关，默认网关缓存B的mac地址以便之后不用重复查询。
4. 默认网关可以与B通信。

即：  
A主机 <----> 默认网关 <----> B主机