# redis持久化
redis提供了两种持久化方式
1. RDB，类似快照的方式，不断记录某个瞬间的数据
1. AOF，即通过写日志的方式，日志中记录每次的写操作

# RDB
如上面描述，RDB采取的是类似快照的方式将数据存储下来，而数据将以二进制被保存在本地，这个文件会记录redis中的所有数据。

可以用如下流程来描述
```
         创建
redis -------->  RDB文件（二进制文件）


        载入
redis <-------   RDB文件（二进制文件）
```

redis提供了有两种方式来生成RDB文件
1. save，采用阻塞的方式生成文件，这时redis会被阻塞掉，导致客户端无法操作redis
2. bgsave，它会fork一个子进程，在子进程中rdb文件

命令 | save | bgsave
---------|----------|---------
 IO类型 | 同步 | 异步
 阻塞 | 阻塞 | 阻塞（只在fork子进程的时候）
 复杂度 | O(N) | O(N)
 优点 | 不会消耗额外内存 | 不阻塞客户端命令
 缺点 | 阻塞客户端命令 | 需要fork，消耗内存

```
# 多少秒内执行多少次操作自动执行bgsave
save 900 1
save 300 10
save 60 100000

# RDB文件名
dbfilename dump-${port}.rdb
# RDB目录
dir ./someBigDiskPath
# RDB文件生过程中出现错误是否停止
stop-writes-on-bgsave-error yes
# 是否压缩
rdbcompression yes
# 是否校验rdb文件
rdbchecksum yes
```